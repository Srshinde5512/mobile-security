apiVersion: apps/v1
kind: Deployment
metadata:
  name: mobsf
  labels:
    app: mobsf
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mobsf
  template:
    metadata:
      labels:
        app: mobsf
    spec:
      # CRITICAL: This ensures MobSF runs on your worker node.
      # Run 'kubectl get nodes' and replace 'worker-node-name' with the actual name.
      nodeSelector:
        kubernetes.io/hostname: database
      containers:
      - name: mobsf
        # REPLACE 'your-username' with your actual Docker Hub username
        image: batataman26/mobile-security-framework-mobsf:latest
        ports:
        - containerPort: 8000
        - containerPort: 1337
        env:
        - name: MOBSF_PLATFORM
          value: "docker"
        # Optional: Prevents the container from using too much RAM
        resources:
          limits:
            memory: "2Gi"
            cpu: "1000m"
          requests:
            memory: "1Gi"
            cpu: "500m"
---
apiVersion: v1
kind: Service
metadata:
  name: mobsf-service
spec:
  type: NodePort
  selector:
    app: mobsf
  ports:
    - name: http
      protocol: TCP
      port: 8000
      targetPort: 8000
      nodePort: 31000 # Access via http://<WORKER_IP>:31000
    - name: proxy
      protocol: TCP
      port: 1337
      targetPort: 1337
      nodePort: 31337
